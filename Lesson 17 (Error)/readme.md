# এরর
আমরা এই লেসনে পিএইচপি এরর নিয়ে বেশ কিছু ব্যাপার জানবো ও শিখবো, পিএইচপিতে ৪ ধরনের এরর আছেঃ

1. **Warning Error:** পিএইচপি-তে ওয়ার্নিং এরর স্ক্রিপ্টটি চলা থেকে থামায় না। এটি শুধুমাত্র আমাদেরকে সতর্ক করে যে একটি সমস্যা আছে, যা ভবিষ্যতে আরও বড় সমস্যা সৃষ্টি করতে পারে। ওয়ার্নিং এরর অনেক কারণে হতে পারে তাদের মধ্যে উলেখযোগ্যঃ

    * একটি এক্সটারনাল ফাইল কল করলাম যা ডিরেক্টরিতে বিদ্যমান নেই।
    * ফাংশনের মধ্যে যদি ভুল প্যারামিটার দেওয়া হয়।

1. **Notice Error:** নোটিশ এরররগুলো হচ্ছে ছোটখাটো এরর৷ এগুলি ওয়ার্নিং এরর মতো এটিও স্ক্রিপ্টটি চলা থেকে থামায় না চলমান রাখে। নোটিশ এরর সাধারণত ঘটে যদি স্ক্রিপ্টটিতে ভুল কোন ভ্যারিয়েবল কল করা হয়।

1. **Parse Error:** পার্স এরর সাধারণত সিনট্যাক্স অপব্যবহার বা অনুপস্থিত চিহ্নের কারণে হয়। কম্পাইলার এররটি ধরে এবং স্ক্রিপ্টটি বন্ধ করে দেয়।
    * আনক্লোজড ব্রাকেটস বা কোটেশন।
    * কিছু মিসিং বা অতিরিক্ত সেমিকোলন বা পারেন্থেসিস।
    * ভুল বানান।
4. **Fatal Error:** ফ্যাটাল এররগুলি হল সেইগুলি যা আপনার প্রোগ্রামকে ক্র্যাশ করে এবং গুরুতর এরর হিসাবে ধরা হয়ে থাকে৷ ফ্যাটাল এরর হলে কিন্তু স্ক্রিপ্টটি চলে না। ফ্যাটাল এরর হওয়ার প্রধান কারণ হলো স্ক্রিপ্টে একটি অনির্ধারিত ফাংশন বা ক্লাস থাকলে। ফ্যাটাল এরর ৩ ধরনের রয়েছেঃ
    * Startup fatal error (যখন সিস্টেম ইনস্টলেশন কোড চালাতে পারে না)
    * Compile time fatal error (যখন একজন প্রোগ্রামার অস্তিত্বহীন ডেটা ব্যবহার করার চেষ্টা করে)
    * Runtime fatal error (প্রোগ্রামটি চলাকালীন ঘটে, যার ফলে কোডটি সম্পূর্ণরূপে কাজ করা বন্ধ করে দেয়)।

পিএইচপি এরর টাইপ সম্পর্কে আরো জানতে এই ২টি [Link1](https://phoenixnap.com/kb/php-error-types "PHP Error Types"), [Link2](https://www.javatpoint.com/types-of-errors-in-php "PHP Error Types") আর্টিকেল পড়তে পারেন অথবা গুগল করে জানতে পারেন।

ধরেন আমাদের সার্ভারে বা লাইভে যখন প্রজেক্ট রান করবে তখন যদি এরর গুলি উজারদের দেখায় বিষয়টা খারাপ দেখাইনা তার জন্য আমরা কিন্তু এরর অফ করে রাখতে পারি। এরর অফ অনেক ভাবে চলুন আমরা কিছু দেখিঃ
```php
    error_reporting(0);
```
সমস্ত ধরনের এরর আর ডিসপ্লেতে শো করবে না। কিন্তু আপনি যদি চান যে কিছু ধরনের এরর আমরা দেখতে তাহলেঃ
```php
    error_reporting(E_WARNING | E_NOTICE);
```
এখন আমরা শুধু ওয়ার্নিং এবং নোটিশ এররগুলো দেখতে পাবো। এরর কনস্টান্টস এবং এদের ভ্যালু দেখার জন্য [Predefined Error Constants.](https://www.php.net/manual/en/errorfunc.constants.php#errorfunc.constants "Predefined Error Constants")

আমরা যদি চাই __php.ini__ ফাইল থেকে এরর গুলো দেখাবে না তার জন্য __php.ini__ ফাইলে গিয়ে `display_errors=On` থাকবে আমরা `display_errors=Off` করে দিবো।
__php.ini__ ফাইল দেখার জন্যঃ
* টার্মিনালে গিয়ে `php --ini` লিখলেই লোডিং __php.ini__ ফাইলের লোকেশন দেখিয়ে দিবে।
* বা কোন পিএইচপি ফাইলে গিয়ে `get_cfg_ver("cfg_file_path")` লিখে রান করলে __php.ini__ লোডিং ফাইলের লোকেশন দেখিয়ে দিবে।

আমরা যদি চাই __php.ini__ ফাইল থেকে `display_errors=Off` না করে পিএইচপি ফাইল থেকে __php.ini__ ব্যাপার গুলো সেট করবো তাহলেঃ
```php
    ini_set('display_errors', 0);
```
__ini_set()__ এই ফাঙ্কশনটি দিয়ে __php.ini__ ফাইলের সব গুলো সেটিং চেঞ্জ করতে পারবো না কিন্তু রান টাইমে অনেক সেটিংস চেঞ্জ করা সম্ভব।

তো উজারদের ডিসপ্লেতে এরর দেখাচ্ছে না এটা বেশ ভালো কিন্তু এরর তো হচ্ছে, এই এরর গুলো কিভাবে ডেভলপাররা দেখবে (সমাধান বা অন্য কিছ করার জন্য) তার জন্য একটা ফাইলে এররগুলো লগ বা জমা করতে হবে, এর জন্য আমাদের __php.ini__ ফাইলে গিয়ে আমাদের অবশ্যই `log_errors=On` অন রাখতে হবে এবং `error_log=` এখানে ফাইল লোকেশন বলে দিতে হবে যেমনঃ `error_log = "C:\php\error\error.txt"` এখন থেকে সব এরর গুলো এই লোকেশনে __error.txt__ এই ফাইলে লগ বা জমা হবে। আমরা শুধু php.ini ফাইলে গিয়ে একটু খুজে `log_errors=On এবং error_log="location"` বসিয়ে দিব এবং যদি সার্ভার যদি অন করা থাকে তাহলে অফ করে আবার ও করবো। এরর গুলো টেক্সট ফাইলে যেমন শো করবেঃ
```txt
[29-Aug-2022 22:31:47 Asia/Dhaka] PHP Warning:  Undefined variable $ifte in C:\learnPHP\Lessson 17 (Error)\e1.php on line 3
```
আর আমরা যদি টাইম জোন চেঞ্জ করতে চাই তাহলে __php.ini__ ফাইলে গিয়ে `date.timezone = Asia/Dhaka` চেঞ্জ করে দিব।

#### [error_log() ফাঙ্কশন](https://www.php.net/manual/en/function.error-log, "পিএইচপি ম্যানুয়াল")
এরর লগ বা এররগুলো একটি ফাইলে কিভাবে জমা করতে হয় তা তো জানলাম, এখন অনেক সময় এমন লাগতে পারে যেমনঃ কোন কন্ডিশন হিট করলে, প্রোডাক্ট অর্ডার বা প্রোডাক্ট না থাকলে ইত্যাদি ইত্যাদি এইসব ব্যাপারেও এরর লগ ফাইলে আমারা এরর হিসাবে এরর লগ ফাইলে জমা রাখলাম এইসব ব্যাপারে কিন্তু আমাদের কাছে অবশ্যই কোডে একসেস থাকবে বা মেইল পাঠাবো তাও কোনো সময় এই ব্যাপারটি লাগতে পারে যে এরর হিসাবে এরর লগ ফাইলে জমা রাখা তাই জেনে রাখা। এটি করার জন্য আমাদের error_log() ফাঙ্কশনটি ব্যাবহার করতে হবে আমদের যদি __php.ini__ ফাইলে `log_errors= এবং error_log=` অফ বা লোকেশন না দেওয়া থাকে তাও চলবে আমরা আলাদা লোকেশন দিয়ে দিতে পারবো ফাঙ্কশনটি মধ্যে আবার এই ফাঙ্কশনটি থেকে মেইল পাঠাতে পারব এই মেইল তখনি যাবে যদি আপনার লোকাল সিস্টেমে কোনো MTA ইনস্টল থাকে। তো এরর লগ ফাইল যদি __php.ini__ তে দেওয়া থাকলে তা দেখার জন্যঃ
```php
    echo ini_get('error_log');
    // Output
    // C:\php\error\error.txt
```
আর যদি না থাকে কোন সমস্যা নেই, তখন আলাদা ভাবে ফাইল লোকেশন দিয়ে দিবো, আর আমরা যদি কাস্টম কোন ডেস্টিনেশন পাঠাতে চাই তাহলে অবশ্যই প্রতি লাইনের শেষে নিউ লাইন এপেন্ড করে দিবোঃ
```php
$date = date("Y:m:d g:i");
$fileName = basename(__FILE__);
error_log("{$date} log in a $fileName file\n", 3, 'C:\Users\Ifte\Desktop\php_errors\error.txt');
// Open C:\Users\Ifte\Desktop\php_errors\error.txt file
// 2022:09:12 4:41 log in a new file
```
যদি মেইল পাঠাতে চাই তাহলেঃ
```php
$headers = "Content-Type: text/html; charset=ISO-8859-1";
error_log("This is and error message",1,"name@gmail.com", $headers);
```
এরর লগ সম্পৰ্কে আরো জানতেঃ [error_log().](https://www.php.net/manual/en/function.error-log, "পিএইচপি ম্যানুয়াল")

### কাস্টম এরর হ্যান্ডলার
আমাদের যদি মনে চাই পিএইচপি যে ভাবে এরর গুলো দেখায়, আমরা তা কাস্টম ভাবে এরর গুলো দেখাবো বা কাস্টম এরর হ্যান্ডলার করবো তাহলে `set_error_handler` এই ফাঙ্কশনটা ব্যবহার করে কাস্টম এরর হ্যান্ডলার বানাতে হবে চলুন দেখা যাক।
```php
set_error_handler('custom_error_handler');
function custom_error_handler($severity, $msg, $file, $line)
{
    switch ($severity) {
        case E_WARNING:
            echo "Error warning [{$severity}]: {$msg} in {$file} on line number {$line}\n";
            break;
        case E_NOTICE:
            echo "Error notice [{$severity}]: {$msg} in {$file} on line number {$line}\n";
            break;
        default:
            echo "Error [{$severity}]: {$msg} in {$file} on line number {$line}\n";
    }
}

echo $name;

```
দেখুন ভ্যারিয়েবল এটি তো অনির্ধারিত তার মানে ওয়ার্নিং এখন যে রকম এরর শো করবে।
```text
Error warning [2]: Undefined variable $book in C:\learnPHP\Lessson 17 (Error)\e2.php on line number 17
```
দেখুন আমরা এখানে এরর টাইপের উপর ভিত্তি করে এরর গুলো কাস্টোমাইজ করে নিচ্ছি।

এছাড়া চাইলে আমরা কাস্টম ভাবে এররকে ট্রিগার বা নির্ধারণ করতে পারি। জায়গায় এরর হওয়ার কথা না সে জায়গায় এরর দিতে পারি ধরেন যে কোন কোডিশনের উপর বেস করে এটা করা হয়ে থাকে `trigger_error()` এই ফাঙ্কশন দিয়ে, এই ফাঙ্কশনে ২টি প্যারামিটার `trigger_error(string $message, E_USER_NOTICE)` দ্বিতীয় প্যারামিটারটি অপশনাল (It only works with the E_USER family of constants, and will default to E_USER_NOTICE). চলুন একটি এক্সাম্পল দেখা যাক:
```php
$name = "ifte";
if("ifte" == $name){
    trigger_error("The name is correct", E_USER_WARNING);
}
/*
Warning: The name is correct in C:\xampp\htdocs\Hasin PHP\Lesson 17 (Error)\e1.php on line 5
*/
```
### ফ্যাটাল এরর হ্যান্ডলার
ফ্যাটাল এরর খুবই মারাত্মক একটি বিষয়, এর জন্য আমাদের কোডে ফ্যাটাল এরর আসা মাত্রই আমরা মেসেজ বা ইমেইল পাঠাবো তাই না কারণ ফ্যাটাল এরর খুবই সিরিয়াস একটি বিষয়। তো ফ্যাটাল এর হ্যান্ডেল করা জন্য আমাদের কিছু ট্রিকসের আশ্রয় নিতে হবে `register_shutdown_function()` এর মধ্যে আমাদের একটা ফাঙ্কশন দিতে হবে, এই register_shutdown_function() এর কাজ হলো প্রত্যেকবার স্ক্রিপ্ট শেষে রান করে তো আমরা যদি এই ফাংশনের মাধ্যমে শেষের এররটা ধরতে পারি তাহলেই তো হয়ে গেলো চলুন কোডে দেখিঃ
```php
register_shutdown_function('fatal_error_handler');

function fatal_error_handler(){
    // এটা লাস্টের এররটা দিবে।
    $error = error_get_last();

    // এটা হলো সব ধরণের এররের জন্য।
    if($error){
        echo "Error $error['type']: $error['message'] in $error['file'] on line number $error['line']\n";
        // এখন থেকে আমরা মেইল বা মেসেজ পাঠালাম যা ইচ্ছে তা করতে পারব।
    }


    // নিদির্ষ্ট ফ্যাটাল এররের জন্য
    if ($error['type'] === E_ERROR) {
        echo "Fatal Error $error['type']: $error['message'] in $error['file'] on line number $error['line']\n";
        // এখন থেকে আমরা মেইল বা মেসেজ পাঠালাম যা ইচ্ছে তা করতে পারব।
    }
}
```
### ডিবাগ করার জন্য ব্যাকট্রেসিং
ডিবাগ করার জন্য পিএইচপিতে খুবই সুন্দর ফীচার আছে তা হলো ব্যাকট্রেসিং, মনেকরি আমরা একটি ফাঙ্কশন কল করলাম এই ফাঙ্কশনটি কোথায় কত নম্বর লাইন থেকে কি আর্গুমেন্ট নিয়ে আসলো তা ডিটেইলে দেখিয়ে দিবে, এটির জন্য `debug_print_backtrace()` ব্যাবহার করা লাগবে কিন্তু কোথায়? যে ফাঙ্কশন থেকে আমরা কল ট্রেস দেখতে চাই সেটির ভিতরে বসিয়ে দিব। চলেন একটি এক্সাম্পল দেখা যাকঃ
```php
function x($a){
    y($a);
}

function y($b){
    z($b*2);
}

function z($c){
    if($c < 20){
        trigger_error("Too Small {$c}\n");
    }else{
        echo "{$c} is okay\n";
    }

    debug_print_backtrace();
}

function w($d, $e){
    x($d+$e);
}

w(5, 6);
```
দেখুন __z()__ এর কাছে কি ভাবে কলটা আসলো __w()__ কল দিচ্ছে __x()__ কে __x()__ কল দিচ্ছে __y()__ কে আবার __y()__ কল দিচ্ছে __z()__ কে একটা কল স্ট্যাক আছে তাই না কে আসলে কোন দিক দিয়ে আসছে এভাবে যদি এনালাইসিস করতে না পারি তাহলে কোন ফাঙ্কশনের মধ্যে যদি এরর আসে তাহলে আমরা কিন্তু দরতে পারব না। এই ব্যাপারগুলোই আমাদের সহজ ভাবে দেখিয়ে দেয় `debug_print_backtrace()` চলেন অউটপুটটি দেখা যাকঃ
```php
// Output
22 is okay
#0 C:\php\Lesson 17 (Error)\e7.php(9): z(22)
#1 C:\php\Lesson 17 (Error)\e7.php(4): y(11)
#2 C:\php\Lesson 17 (Error)\e7.php(25): x(11)
#3 C:\php\Lesson 17 (Error)\e7.php(28): w(5, 6)
```
কত ডিটেইলে দেখিয়ে দিয়েছে এখন আমরা সহজেই বুজতে পারবো যে কোথাই কি এরর হয়ে হয়েছে তা বুজে সহজেই ডিবাগ করে ফেলব, সবসময় নিচের থেকে উপরের দিকে দেখবেন তাহলেই আপনার নিদির্ষ্ট ফাঙ্কশনে কি ভাবে কল গেলো বুজে যাবেন।

আর আমরা যদি ডাটাটা এরে আকারে দেখতে চাই তাহলে `debug_backtrace()` প্রিন্ট করে দেখতে হবে। আমরা উপরের ফাঙ্কশনের `debug_print_backtrace()` জাগায় যদি `debug_backtrace()` প্রিন্ট করি তাহলে আউটপুটটি হবেঃ
```php
// লিমিট করে দিলাম 
print_r(debug_backtrace(0, 2));
// আউটপুট
Array
(
    [0] => Array
        (
            [file] => C:\php\Lesson 17 (Error)\e5.php
            [line] => 10
            [function] => z
            [args] => Array
                (
                    [0] => 10
                )

        )

    [1] => Array
        (
            [file] => C:\php\Lesson 17 (Error)\e5.php
            [line] => 5
            [function] => y
            [args] => Array
                (
                    [0] => 5
                )
        )
)
```
__debug_backtrace() ও debug_print_backtrace()__ দুটোতেই অপশনস এবং লিমিট আর্গুমেন্ট দেওয়া যাই। পিএইচপি ম্যানুয়াল থেকে বিস্তারিত দেখে নেয়ঃ [debug_print_backtrace()](https://www.php.net/manual/en/function.debug-print-backtrace.php "পিএইচপি ম্যানুয়াল"), [debug_backtrace()](https://www.php.net/manual/en/function.debug-backtrace "পিএইচপি ম্যানুয়াল").

কাস্টম এক্সেপশন নিয়ে একটি সুন্দর এক্সাম্পল দেখতেঃ [Example](./e6.php "e6.php"). এক্সেপশন সম্পর্কে আরও পড়তে ও জানতে [Exception](../Lesson%2012%20(Exception)/readme.md/ "Exception").

এরর নিয়ে এতটুকই যা পড়লাম ও দেখলাম আশাকরি আমরা বুঝতে পেরেছি ।